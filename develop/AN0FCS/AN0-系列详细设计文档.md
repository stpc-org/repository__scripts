# AN0-系列 文档

## AN0-FCS

### 功能需求

1. [x] 支持多炮塔控制
2. [ ] 支持飞船控制 (朝向数据输出信号)
3. [x] 识别功能
      - [x] 基于网格图扫描的识别机制, 完全自动扫描各种炮塔结构
        - 网格图: 完全构建脚本所在的实体的网格结构, 以此进行后续扫描
        - 延迟扫描, 识别炮塔或者炮塔部件结构, 进行图遍历时延迟扫描
        - 若实体的网格数量太过庞大, 用户可以设定一些断连的边, 以此降低扫描时的时间复杂度
        - 完全自动识别方向机高低级物理位置正反装和逻辑结构正反装
          - 物理位置正反装是指, 高低机和方向机在物理位置上的正反方向
            - 正反方向
              - 如果两个高低机或者方向机的 `前向量` 在空间中的夹角低于90度, 则认为是同向的
              - 如果两个高低机或者方向机的 `前向量` 在空间中的夹角高于90度, 则认为是反向的
            - 本脚本不要求同一个炮塔上的高低机或者方向机的旋转轴在空间上完全平行
              - 解决方案, 提供一个旋转轴之间的夹角容忍度, 低于阈值则可以识别
          - 逻辑结构正反装是指, 高低机或者方向机的基座所在的位置
            - 正反方向
              - 如果基座所在位置处于网格结构的更外层, 距离指示器更远, 则认为是正向的
              - 如果基座所在位置处于网格结构的更内层, 距离指示器更近, 则认为是反向的
        - 由于基于图扫描, 因此对于炮塔结构的要求宽泛
          - 高低机和方向机在空间上不必正交
          - 高低机和方向机所在的网格不必直接相连, 中间可以间隔任意数量的网格
          - 同一个炮塔的方向机或者高低机之间也不必处于同一个网格, 中间可以间隔任意数量的网格
          - 同一个炮塔的方向机之间或者高低机之间也不必正交, 可以呈角度安装
            - 注: `前向量` 之间的夹角可以设定最大容忍度, 但高低机或者方向机以 `前向量` 为轴则可以任意旋转
          - 多个炮塔的主体结构方向朝向任意, 不必正交安装
          - 炮塔中可以完整嵌套安装炮塔, 可以识别
4. [ ] 完善的交互模式
      - TODO
5. [x] 配置和使用
      - [x] 主要配置写在编程块 CD 中
      - [x] 对于每一个被脚本识别的炮塔, 脚本在编程块 CD 的主要配置后方动态地为其提供一个配置区域
6. [ ] 目标打击功能
      - [x] 基于当前载具速度, 打击目标速度, 打击目标加速度, 投射物初速度, 投射物全局加速度数据进行射击预判
      - [x] 基于打击目标的加速度, 维护一个短期内平均加速度的近似值, 防止目标加速度高频率震荡对预判射击的干扰
      - [ ] 针对目标加速度进行机动性的评估, 机动性过高则修改预判策略
        - [ ] 预判策略
      - [ ] 开放定时器接口
        - [x] `开始射击` 定时器接口
        - [x] `停止射击` 定时器接口
        - [ ] `射击一次` 定时器接口
      - [ ] 目标局部预判功能(根据目标的朝向)
      - [ ] 炮塔在选择目标时根据其自身的配置进行选择 (例如优先选择低速度的, 或者必须选择处于盲区内的对象等)
7. [ ] 炮塔盲区检测
      - [x] 带限位角的方向机智能反向旋转
      - [ ] 炮塔方向机高低机的完整盲区检测
8. [ ] 通信机制
      - [ ] 接受 AN0-RADAR 脚本实例发出的目标对象数据
      - [ ] 根据接受到的目标对象数据按多种规则进行排序, 维护多个有序的对象列表 (距离, 速度, 加速度, 机动性等)


## AN0-RADAR

### 功能需求

1. [x] 目标识别功能
      - [x] 游戏原生炮塔的目标对象的识别
      - [x] 用户主动通过摄像头扫描提供目标
2. [x] 目标锁定功能
      - [x] 摄像头目标锁定机制
        - [x] 对非数摄像头的支持 (已废弃)
        - [x] 支持活动或固定位摄像头
        - [x] 非无限能量时的平滑消耗机制
3. [ ] 通信机制
      - [ ] 为用户提供一个频道配置, 用户决定当前脚本在哪个频道通信
        - [ ] 同频道的各个 AN0 系列脚本可以相互通信
        - [ ] 相同频道之间可发送文本消息
        - [ ] 不同频道之间仅可发送文本消息, 不可进行脚本间数据的通信
      - [ ] 与其它 AN0-RADAR 脚本之间的数据通信
        - [ ] 用户指定脚本通信频道之后, 网络中的多个 AN0-RADAR 脚本实例自行维护一个内部频道 , 内部频道用于共享目标数据
          - [ ] 每个 AN0-RADAR 脚本实例会发送给相同频道中的其它 AN0-RADAR 脚本其自身当前所拥有的目标信息
          - [ ] 每个 AN0-RADAR 脚本实例同时维护自身识别到的目标数据和从别的脚本实例中获取的目标数据
      - [ ] 与 AN0 系列其它脚本实例的通信
        - [ ] AN0-RADAR 脚本实例会将其所拥有的目标数据进行本地网格广播
        - [ ] AN0-RADAR 接受摄像头扫描坐标的消息, 通常由 AN0-FCS 发出该类型消息 (可以配置是否接收)
        - [ ] 可以选择是否开启与 AN0-FCS 联动, 如果不开启联动则 AN0-R 脚本不接受 AN0-FCS 发出的扫描指令



### 开发计划

- 开发计划:
  - [ ] 若 AN0-FCS 和 AN0-R 同时存在则由 AN0-FCS 驱动 AN0-R (AN0-FCS 本地广播扫描目标坐标的消息, 由 AN0-R 广播扫描到的数据)
  - [ ] AN0-R 脚本启动时选择是否开启与 AN0-FCS 联动, 如果不开启联动则 AN0-R 脚本不接受 AN0-FCS 发出的扫描指令
  - [ ] 可以配置是否让 AN0-FCS 发出扫描指令. 若仅存在 AN0-R 脚本, 则使用 AN0-R 脚本的扫描机制. 
  - [ ] (进入被注册的摄像头后使用摄像头直射扫描, 与是否与 AN0-FCS 联动无关, 但可通过配置开关)
